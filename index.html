<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0, maximum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>Audio To Text</title>
<script type="text/javascript" charset="utf-8" src="cordova.js"></script>  
<link rel="stylesheet" href="themes/sbobinator.min.css" />
<link rel="stylesheet" href="themes/jquery.mobile.icons.min.css" />
<link rel="stylesheet" href="jquery-mobile/jquery.mobile.structure-1.4.5.min.css" />
<link rel="stylesheet" href="themes/style.css" />
<script src="jquery-mobile/jquery-1.11.1.min.js"></script>
<script src="jquery-mobile/jquery.mobile-1.4.5.min.js"></script>
</head>

<body>
<script src="js/appodeal.js"></script> 

<script type="text/javascript">
var recognition;
document.addEventListener('deviceready', onDeviceReady, false);

function onDeviceReady() {
	  setTimeout(
        function() {
          Appodeal.show(Appodeal.BANNER_BOTTOM);
         }, 3000);
    recognition = new SpeechRecognition();
	recognition.lang = window.localStorage.getItem("deflang");
	//recognition.lang = 'it-IT';
    recognition.onresult = function(event) {
        if (event.results.length > 0) {
            q.value = event.results[0][0].transcript;
			document.getElementById("recbut").src="img/button.png";
            $( "#txtpopup" ).popup( "open" )
        }
    }
}

function Registra() {
	document.getElementById("recbut").src="img/button_load.gif";
	recognition.start();
	Appodeal.show(Appodeal.BANNER_BOTTOM);
}

</script>

<div data-role="page" data-theme="a" id="home">
<!-- leftpanel1  -->
	<div data-role="panel" id="menu" data-position="left" data-display="overlay" data-theme="a">
        <a href="#" data-rel="close" data-role="button" data-theme="a" data-icon="delete" data-iconpos="notext" class="ui-btn-right">Close</a>
        <h3>Impostazioni</h3>
<ul data-role="listview" data-inset="true">
    <li><a href="#" onclick="deflang('fr-FR')"><img src="img/Flags/France.png" alt="Français" class="ui-li-icon ui-corner-none">Français</a></li>
    <li><a href="#" onclick="deflang('es-ES')"><img src="img/Flags/Spain.png" alt="Español" class="ui-li-icon">Español</a></li>
    <li><a href="#" onclick="deflang('en-US')"><img src="img/Flags/Usa.png" alt="Great Britain" class="ui-li-icon">English (US)</a></li>
    <li><a href="#" onclick="deflang('it-IT')"><img src="img/Flags/Italy.png" alt="Finland" class="ui-li-icon">Italiano</a></li>
</ul>
        <a href="#txtpopup"  data-rel="popup" data-role="button" >Ultimo audio</a>
	</div><!-- /leftpanel1 -->

<div data-role="header">
<a href="#menu" class="ui-nodisc-icon ui-btn ui-shadow ui-corner-all ui-btn-b ui-icon-bars ui-btn-icon-notext" style="margin-top:20px;background:none;box-shadow: none;">Menu</a>
</div><!--header-->

<div data-role="content">
<img id="recbut" src="img/button.png" alt="rec" onclick="Registra()" />
<p align="center">Tocca per registrare</p>
</div>
		
		<div data-role="popup" id="txtpopup" class="ui-content" style="max-width:280px" data-position-to="window" data-inline="true">
			<a href="#" data-rel="back" data-role="button" data-theme="a" data-icon="delete" data-iconpos="notext" class="ui-btn-right">Close</a>
            <p>I have a close button at the top right corner with simple HTML markup.</p>
            <textarea id="q" name="q"></textarea>
		</div><!--/popup-->
</div>


<div data-role="page" data-theme="a" id="preselect">

<div data-role="content">
<ul data-role="listview" data-inset="true">
    <li><a href="#" onclick="deflang('fr-FR')"><img src="img/Flags/France.png" alt="Français" class="ui-li-icon ui-corner-none">Français</a></li>
    <li><a href="#" onclick="deflang('es-ES')"><img src="img/Flags/Spain.png" alt="Español" class="ui-li-icon">Español</a></li>
    <li><a href="#" onclick="deflang('en-US')"><img src="img/Flags/Usa.png" alt="Great Britain" class="ui-li-icon">English (US)</a></li>
    <li><a href="#" onclick="deflang('it-IT')"><img src="img/Flags/Italy.png" alt="Finland" class="ui-li-icon">Italiano</a></li>
</ul>
</div>

</div>
<!--script-->
<script>
document.addEventListener('deviceready', onDeviceReady, false);

function onDeviceReady() {
	
if (window.localStorage.getItem("deflang") === null) {
	$(document).delegate("#home", "pageshow", function(event) {
    setTimeout(function() {
       if($.mobile.activePage.attr("id") == "home") {
            $.mobile.changePage("#preselect", {
                transition: "slide"
            });
        }
    }, 10);});
}
	
}
</script>
<script type="text/javascript">
function deflang(language) {
	switch (language) {
		case "it-IT":
		window.localStorage.removeItem("deflang");
		window.localStorage.setItem("deflang", "it-IT");
		$.mobile.changePage("#home", {
                transition: "slide"
            });
		location.reload(); 	
		break;
		case "en-US":
		window.localStorage.removeItem("deflang");
		window.localStorage.setItem("deflang", "en-US");
		$.mobile.changePage("#home", {
                transition: "slide"
            });
		location.reload(); 
		break;
		case "es-ES":
		window.localStorage.removeItem("deflang");
		window.localStorage.setItem("deflang", "es-ES");
		$.mobile.changePage("#home", {
                transition: "slide"
            });
		location.reload(); 
		break;
		case "fr-FR":
		window.localStorage.removeItem("deflang");
		window.localStorage.setItem("deflang", "fr-FR");
		$.mobile.changePage("#home", {
                transition: "slide"
            });
		location.reload(); 
		break;
	}
}
</script>
</body>
</html>
